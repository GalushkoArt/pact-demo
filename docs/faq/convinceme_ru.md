---
title: Убедите меня
description: Как убедить свою команду, начальника или себя в том, что контрактное тестирование — хорошая идея
---

Главное, что волнует любую организацию при разработке ПО — это **стоимость**. При создании продукта самое дорогое — это, скорее всего, ваше время. Также значительные расходы связаны с вычислительными ресурсами (например, облачные провайдеры, частные дата-центры). Хотя внедрение контрактных тестов и их интеграция в CI/CD требуют первоначальных затрат, в долгосрочной перспективе они обходятся дешевле, особенно если использовать их вместо традиционных end-to-end (E2E) интеграционных тестов. Почему:

* Контрактные тесты экономят **время разработки**, потому что:
  * предоставляют очень быструю обратную связь разработчикам и тестировщикам ([быстрая обратная связь ускоряет доставку ПО](https://dzone.com/articles/how-to-use-fast-feedback-loops))
  * чётко указывают, где возникла проблема
  * позволяют отлаживать сбои локально, а не полагаться на системные логи
  * снижают время, потраченное на отладку ошибок, вызванных окружением, а не интеграционными багами

* Контрактные тесты экономят **ресурсы и машинное время**, потому что:
  * снижают количество или полностью устраняют необходимость тестов в развернутом окружении
  * работают быстрее, чем те интеграционные тесты, которые они заменяют

* **Контрактные тесты, управляемые потребителем**, экономят **время разработки**, потому что:
  * гарантируют реализацию только тех частей API, которые действительно будут использоваться

Попробуйте отследить, сколько времени ваша команда тратит на:

* Построение и поддержку тестовых окружений
* Написание и выполнение интеграционных тестов
* Отладку сбоев в интеграционных тестах
* Исправление нестабильных (flaky) тестов

Разве не лучше было бы инвестировать это время в надёжные и быстрые тесты, позволяющие гибко реагировать на изменения?

## Что такое контрактное тестирование?

По сравнению с E2E-тестированием, контрактное тестирование позволяет выстроить предсказуемую кривую сложности и скорости пайплайна, как на графике ниже, сохраняя при этом многие гарантии безопасности, характерные для E2E-подходов:

![Из https://pactflow.io/blog/what-is-contract-testing/?utm_source=ossdocs&utm_campaign=convince_me_what_is](img/time-effort-contract-testing-vs-e2e.svg)

Подробнее о «почему» — в [оригинальной статье](https://pactflow.io/blog/what-is-contract-testing/?utm_source=ossdocs&utm_campaign=convince_me_what_is).

## Как начать использовать контрактное тестирование?

Поняв, что такое контрактное тестирование и как оно может помочь вам, следующим шагом будет внедрение его в вашей среде. Этот [гайд](https://blog.pactflow.io/why-contract-testing/?utm_source=ossdocs&utm_campaign=convince_me_how_to_start) поможет вам начать путь.

## А если я считаю, что end-to-end (E2E) тесты — это хорошо?

Прочтите следующее, чтобы разубедить себя:

* [Proving E2E tests are a scam](https://pactflow.io/blog/proving-e2e-tests-are-a-scam/?utm_source=ossdocs&utm_campaign=convince_me)
* [Just say no to more end-to-end tests](http://googletesting.blogspot.com.au/2015/04/just-say-no-to-more-end-to-end-tests.html)
* [Integrated tests are a scam](http://blog.thecodewhisperer.com/permalink/integrated-tests-are-a-scam)
* и, если вам интересно: [Defect Analysis and Prevention for Software Process Quality Improvement](http://www.ijcaonline.org/volume8/number7/pxc3871759.pdf)

Исследования показывают, что интеграционные тесты требуют больше времени, усилий и затрат на сопровождение, при этом не дают дополнительных гарантий.

**Посмотрите видео**

[Ссылка на youtube](https://www.youtube.com/watch?v=U05q0zJsKsU) Или [всю серию о контрактном тестировании](https://www.youtube.com/watch?v=U05q0zJsKsU&list=PLwy9Bnco-IpfZ72VQ7hce8GicVZs7nm0i)

## Распространённые отговорки

### …но мы все в одной команде, нам не нужны контракты

Может быть, сейчас вы все в одной команде, но:

* приходят новые люди — и у них нет всего контекста
* люди уходят — и забирают знания и практики
* происходят реорганизации — и меняются владельцы продуктов
* люди — не идеальны, и коммуникация не всегда работает, даже при лучших намерениях

Интересный факт — команда, написавшая Pact, тоже была «в одной команде».

### …но мы строго следуем инженерным практикам и делаем только обратносуместимые изменения

Отлично! См. выше.

### …но у меня уже есть локальный Mock Server (например, VCR, MockServer)

Pact — это как VCR наоборот. VCR записывает поведение поставщика и проверяет, что потребитель работает корректно. Pact записывает поведение потребителя и проверяет поставщика. Его преимущества:

* Возможность разработать потребителя (например, UI на JavaScript) до появления поставщика (например, JSON API)
* Возможность сначала задать требования к API, реализуя только нужное
* Документированные юзкейсы (`Given... when... then...`), показывающие, как используется API
* Видимость, какие поля реально используются, что позволяет удалять неиспользуемые и добавлять новые без влияния на потребителей
* Видимость, каких потребителей затронет изменение
* С [Pact Broker](https://github.com/pact-foundation/pact_broker) — возможность отобразить связи между сервисами

Сравнение с другими решениями: [https://docs.pact.io/getting_started/comparisons](https://docs.pact.io/getting_started/comparisons)

### …но я использую Swagger/OpenAPI

OpenAPI и Pact имеют разные цели. Основные отличия:

* **OpenAPI** описывает структуру API, генерирует документацию и UI, но **не является тестовой системой**
* **Pact** — это фреймворк для unit-тестирования, использующий _спецификацию через примеры_

OpenAPI можно использовать в контрактном тестировании, если вы:

* уверены, что спецификация отражает поведение API (включая ошибки и варианты)
* проверяете, что потребители используют API строго в соответствии со спецификацией
* избегаете изменений, нарушающих ожидания потребителей
* распространяете изменения на всех потребителей
* деплоите только совместимые версии сервисов

Если вы используете OpenAPI, рассмотрите [Swagger Mock Validator](https://bitbucket.org/atlassian/swagger-mock-validator) от Atlassian.

Комбинируя OpenAPI с Pact, вы получаете уверенность как в соответствии внешним спецификациям, так и в реальных требованиях внутренних потребителей.

Подробнее: [https://github.com/pact-foundation/pact-specification/issues/28](https://github.com/pact-foundation/pact-specification/issues/28)

**Pact превосходит Swagger при изменениях API**, т.к. позволяет мгновенно понять, кого затронет изменение, и какие команды нужно уведомить. Вы увидите, когда потребители начали использовать новое поведение, и сможете безопасно удалить устаревшее. С Swagger это может занять недели или месяцы.

### …но у меня уже есть E2E тесты?

Проблемы E2E тестов:

* Требуют деплоя перед обнаружением багов — а это долго
* Медленные — из-за чего начинают группировать изменения, что плохо для CD
* Трудно координировать: как убедиться, что все компоненты нужной версии?
* Сложность растёт нелинейно
* Зачем вам заботиться о поведении чужих систем?

**Тест на правду**: если вы _действительно_ получаете пользу от E2E без больших усилий — продолжайте. Но если у вас есть выделенные люди под релизный процесс — возможно, вы идёте не туда.

Хотите оставить их? Переместите часть сценариев в конец пайплайна как "Smoke Tests".

_ПРИМЕЧАНИЕ: не стоит полностью отказываться от E2E. Всё хорошо в меру._

### …но я использую Docker?

См. выше про E2E. Проблемы никуда не исчезают — Docker лишь оттягивает боль.

### …но у нас сначала разрабатываются API, потом потребители (API-first или Document-driven подход)

Значит, у вас много потребителей? Если вы не знаете, кто они — Pact, возможно, не для вас. Но если вы контролируете хотя бы часть — Pact подойдёт. Просто дизайн будет не от потребителя (и это нормально).

### …но я вам не доверяю

И правильно делаете! Начните с малого проекта, чтобы лично убедиться в ценности Pact.

И вообще, Pact — не единственный способ делать контрактное тестирование. Он просто упрощает процесс.

## Ладно, я убедился. А как убедить других?

Вот несколько идей:

* Посмотрите отличные доклады с командой за обедом
* [Пригласите](https://slack.pact.io) одного из контрибьюторов Pact на встречу или онлайн-сессию
* [Поговорите](https://slack.pact.io) с нами в Slack — мы можем поспорить за вас 😄
