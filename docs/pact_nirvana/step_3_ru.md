---
title: 3. Бронза — вручную запустить один работающий тест
---

<details open>
  <summary>Диаграмма уровня "Бронза"</summary>

```plantuml
@startuml
left to right direction
[Тест потребителя] --> [Pact файл] : запись
[Pact файл] --> [Проверка провайдера (локально)] : чтение
@enduml
````

</details>

Если вы раньше не работали с Pact, стоит сначала попробовать его на
[вспомогательном (spike)](https://ru.wikipedia.org/wiki/Spike_%28разработка_ПО%29) приложении.

Это самые простые первые шаги, которые можно предпринять.

## Задачи

1. Напишите тест Pact в проекте потребителя и сгенерируйте pact-файл.
2. Передайте pact-файл команде поставщика вручную (позже мы познакомим вас с концепцией Pact Broker).
3. Выполните верификацию контракта у поставщика (см. документацию для выбранного вами языка).
4. Обсудите результат.
5. Решите, подходит ли Pact для вашего случая, учитывая, что есть ситуации, в которых Pact —
   [хорошее решение](../getting_started/what_is_pact_good_for_ru#В-чём-Pact-особенно-хорош), и ситуации, в которых Pact —
   [неподходящее решение](../getting_started/what_is_pact_good_for_ru#В-чём-Pact-неэффективен).

### Напишите тест потребителя без состояний поставщика

Pact — это фреймворк контрактного тестирования, управляемый со стороны потребителя. Это означает, что контракт
формируется потребителем на основе его понимания интерфейса и собственных потребностей.

Это действительно важно и мощно. Слишком часто поставщики предполагают, что нужно потребителям, и проектируют API,
исходя из этих догадок. Когда потребитель управляет контрактом, API лучше соответствует его требованиям.

Поэтому сначала пишется тест потребителя. Подробнее о тестах потребителя можно прочитать
[здесь](https://docs.pact.io/consumer).

Если вы работаете в команде поставщика, вы не являетесь владельцем этого теста, хотя можете помочь потребителю в его
написании. В конечном итоге, это ответственность команды потребителя — они формируют понимание контракта.

Важно: на первом этапе по возможности избегайте введения состояний поставщика. Это можно будет добавить позже.

### Ручной запуск теста верификации поставщика

Когда вы запускаете тест потребителя и он успешно проходит, будет сгенерирован pact-файл (подробнее см.
[обзор](https://docs.pact.io/getting_started/how_pact_works#consumer-testing)). Этот файл содержит описание серии
взаимодействий, в которых потребитель отправляет запрос, а поставщик возвращает ожидаемый ответ.

Теперь необходимо проверить, действительно ли поставщик ведёт себя так, как ожидает потребитель. В дальнейшем эта
проверка будет происходить автоматически при запуске тестов поставщика локально и в CI/CD.

Существует два типа верификации pact-контрактов:

1. Верификация по URL или пути к файлу (предназначена для запуска через webhook при изменении контракта потребителя)
2. Верификация по селекторам версии потребителя (запускается при изменении кода поставщика в CI)

На этом этапе вы вручную проверите тип 1 — верификацию контракта по локальному файлу или удалённому URL.
Это полезно для отладки и запуска тестов локально.

* Получите pact-файл, сгенерированный потребителем
* Скопируйте его в доступную для поставщика папку
* Напишите тест верификации поставщика, указав путь к этому pact-файлу
* Запустите тест и посмотрите, пройдёт ли он

Обычно с первого раза он не проходит (если только вам не очень повезёт). Поэтому теперь можно итеративно работать с
обеими сторонами, пока тесты не пройдут.

### Дополнительные замечания

Также существуют такие возможности, как:

* состояния поставщика (provider states)
* сопоставители (matchers)

Однако прежде чем переходить к ним, выполните этот базовый сценарий, чтобы понять, как работают этапы генерации и
верификации pact-контрактов. Это станет частью нашего курса "С отличием".
